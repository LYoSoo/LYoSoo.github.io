<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>你不知道的JavaScript --读书笔记 | LYoSoo’s Blog</title>
    <meta name="generator" content="VuePress 1.5.1">
    
    <meta name="description" content="我的个人网站">
    <link rel="preload" href="/assets/css/0.styles.c078221e.css" as="style"><link rel="preload" href="/assets/js/app.84afcb5e.js" as="script"><link rel="preload" href="/assets/js/2.5a4a2598.js" as="script"><link rel="preload" href="/assets/js/5.4013f8dd.js" as="script"><link rel="prefetch" href="/assets/js/3.52fb6882.js"><link rel="prefetch" href="/assets/js/4.77c04d85.js"><link rel="prefetch" href="/assets/js/6.fb2026c8.js"><link rel="prefetch" href="/assets/js/7.3911237f.js"><link rel="prefetch" href="/assets/js/8.f3e0c51c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c078221e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.jpg" alt="LYoSoo’s Blog" class="logo"> <span class="site-name can-hide">LYoSoo’s Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/LYoSoo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  有问题请问我
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/LYoSoo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  有问题请问我
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="你不知道的javascript-读书笔记"><a href="#你不知道的javascript-读书笔记" class="header-anchor">#</a> 你不知道的JavaScript --读书笔记</h2> <blockquote><p>​	最近看《你不知道的JavaScript》发现很有收获，这本书由浅入深感觉讲的很好，这篇读书笔记一是为了巩固自己的看到的一些东西，二是想有一些输出。</p></blockquote> <h3 id="一、作用域"><a href="#一、作用域" class="header-anchor">#</a> 一、作用域</h3> <blockquote><p>​	JavaScript是一门编译语言，但是相比传统编译语言，JavaScript引擎还会在语法分析和代码生产阶段有特定的步骤对性能进行优化。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>上面简单的一行代码，运行的过程如下</p> <ul><li><p>看到 <code>var a</code> 编译器会先询问在作用域中是否已经存在了该变量，如果已经存在，则会忽略该声明；如果不存在，则会声明一个新的变量，命名为 <code>a</code>。</p></li> <li><p>第二步编译器会为引擎运行时生成所需的代码，用来处理 <code>a = 2</code>这个操作。引擎首先会询问作用域，在当前作用域集合中是否存在 <code>a</code> 的变量，如果存在，使用这个变量；若不存在，继续查找该变量。</p></li> <li><p>最后如果查找到了 <code>a</code> 变量，则会把 <code>2</code> 赋值给该变量，否则会抛出异常。</p> <p><strong>总结下来其实就是两个操作： 首先编译器在当前作用域声明一个变量（之前该变量未被声明），在运行时按照特殊的规则查找该变量（具体规则后续会说），找到了就对他赋值，未找到就抛出异常。</strong></p></li></ul></blockquote> <p><strong>其实作用域就是根据名称查找变量的一套规则</strong></p> <blockquote><p>​	实际上我们通常要同时顾及好几个作用域。</p> <p>​	当一个块或者函数嵌套在另一个块或者函数时，就发生了作用域嵌套。	当在上面讲的第二阶段中查找当前作用域集合中是否存在某个变量时，如果不存在，则会在外层嵌套的作用域中继续查找，直到找到该变量，或者抵达最外层的作用域位置, 也就是全局作用域 <code>window</code>。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//4</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>上面就是一个典型的作用域查找规则， 在<code>foo</code>函数内部未找到变量 <code>b</code>的时候，会继续向嵌套的上层作用域查找，也就是全局作用域，在全局作用域中找到了变量 <code>b</code>。</p></blockquote> <h3 id="二、词法作用域"><a href="#二、词法作用域" class="header-anchor">#</a> 二、词法作用域</h3> <blockquote><p>​	我们在上面把“作用域” 看成是一套管理引擎如何在当前作用域以及嵌套的子作用域中根据标识符名称进行变量查找的规则。</p> <p>​	作用域又分为 “词法作用域”  与 “动态作用域” 两种。</p> <p>​	<strong>词法作用域是后面学习闭包的重要知识，如果不能完全清楚词法作用域，闭包也不可能理解。</strong></p> <p>​	简单来说，词法作用域就是定义在词法阶段的作用域，是由你写代码时将变量和块作用域写在哪里决定的。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">var</span> b <span class="token operator">=</span> a <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
        <span class="token function">bar</span><span class="token punctuation">(</span>b <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 2, 4, 12</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>作用域按从外到内的分法，分别为最外层的全局作用域， 包含一个标识符： <code>foo</code> ；</p> <p><code>foo</code> 函数创建的作用域， 包含三个标识符： <code>a</code> 、 <code>bar</code> 、 <code>b</code> ；</p> <p><code>bar</code> 所创建的作用域，包含一个标识符： <code>c</code> ;</p> <p>当引擎执行代码时，会从最内部的作用域开始查找，无法在当前作用域找到对应的变量，则会到上一级嵌套的作用域中继续查找。<strong>作用域会在找到第一个匹配的标识符时停止。</strong></p></blockquote> <h3 id="三、函数作用域和块作用域"><a href="#三、函数作用域和块作用域" class="header-anchor">#</a> 三、函数作用域和块作用域</h3> <blockquote><p>​	<strong>函数作用域： 属于这个函数的全部变量都可以在整个函数的范围内使用以及复用（嵌套的作用域也可以）。</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token operator">...</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>​	上面的代码里函数 <code>foo</code> 的作用域气泡中包含了 <code>b</code> 、 <code>bar</code> 、 <code>c</code> 三个标识符，这些标识符所代表的变量或函数都属于所处作用域的气泡。</p> <p>​	全局的作用域气泡含有 <code>foo</code>这个标识符。</p> <p>​	所以我们在全局中只可以访问 <code>foo</code>  无法访问 <code>foo</code> 内部的作用域气泡。</p></blockquote></blockquote> <h5 id="隐藏内部"><a href="#隐藏内部" class="header-anchor">#</a> 隐藏内部</h5> <p>​		上面之前我们可以看到，我们是无法从外面的作用域访问到函数内部的作用域，在软件设计中，<strong>我们要最小限度的暴漏内部的内容，将其他内容“隐藏”起来，比如模块或者内部API设计</strong>。</p> <p>​		我们可以讲代码中的片段，用一个函数声明对他进行包装，实际就是把他隐藏了起来。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        b <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token function">doSomethingElse</span><span class="token punctuation">(</span>a <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">function</span> <span class="token function">doSomethingElse</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> a <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> b<span class="token punctuation">;</span>
	<span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//15</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p>​	上面的代码片段， 变量 <code>b</code> 和函数 <code>doSomethingElse</code> 都应该是函数  <code>doSomething</code> 的内部“私有”内容，但现在暴露在了外面， 也就是可以访问 <code>doSomething</code>的作用域同时可以访问变量 <code>b</code> 和函数 <code>doSomethingElse</code>,  这样不仅没必要，而且还是“危险的”， 造成不必要的麻烦， 合理的设计是要帮他们隐藏在 <code>doSomething</code>的内部。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token keyword">function</span> <span class="token function">doSomethingElse</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> a <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">var</span> b<span class="token punctuation">;</span> 
     b <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token function">doSomethingElse</span><span class="token punctuation">(</span>a <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
	<span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//15</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>此时 <code>b</code> 和 <code>doSomethingElse</code> 都无法从外部被访问， 只能被 <code>doSomething</code> 所控制，将其私有化了。</p> <p>​	“隐藏”作用域的变量和函数的另一个好处是可以避免同名标识符之间的冲突，当你无意间命名了两个相同的标识符，就会造成覆盖。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            i <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>			<span class="token comment">//可以修改下面for循环中的 i </span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">bar</span><span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// i 被赋值为3， 一直小于10 造成死循环</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>如果第三方库没有隐藏好自己的内部变量，在我们同时引入多个三方库的时候，很容易的引发冲突</p> <p>所以第三方的库都会在全局作用域中声明一个足够特别的变量，用来做自己的命名空间，需要暴露给外部的功能都是其属性，避免讲自己的标识符暴露在顶级的词法作用域中。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> specialModuleName <span class="token operator">=</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">doSomething</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">doSomethingElse</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></blockquote> <h4 id="函数作用域"><a href="#函数作用域" class="header-anchor">#</a> 函数作用域</h4> <blockquote><p>​	上面我们说了可以通过函数把想要隐藏的标识符包裹起来，这样外部的作用域无法访问内部的标识符。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 3</span>
 <span class="token punctuation">}</span>
	<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">//2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这样虽然解决了一些问题，但是还是需要声明 <code>foo</code> 这个函数，并在之后对其进行调用，声明的 <code>foo</code> 函数同样污染了当前作用域。</p> <p>在JavaScript中有这样一种解决方案</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//3</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>函数被包裹在 () 内部， 变成了表达式，在末尾加上 () 用来执行这个表达式， 这种写法叫做“立即执行函数表达式” 平时叫  立即执行函数（IIFE）。</p> <p>这样 <code>foo</code> 就被隐藏起来了，不会污染外部的作用域。</p> <p>​		立即执行函数还一个用法就是把他们当作函数调用并传递参数进去。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token constant">IIFE</span><span class="token punctuation">(</span><span class="token parameter">global</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//3</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>global<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//2</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>在IIFE中传入 <code>window</code> 对象，把参数命名为 <code>global</code>。</p> <p><strong>IIFE更重要的一种用法是倒置代码的运行顺序，将需要运行的函数放在第二位。</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token constant">IIFE</span><span class="token punctuation">(</span><span class="token parameter">def</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">def</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">def</span><span class="token punctuation">(</span><span class="token parameter">global</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> 		<span class="token comment">//3</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>global<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//2</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>​	上面代码函数<code>def</code>定义在第二部分， 作为 <code>IIFE</code>的参数传递进去， 然后在<code>IIFE</code>内部调用 函数 <code>def</code>，并将 <code>window</code> 传入当作自定义 <code>global</code> 的值。</p></blockquote></blockquote> <h4 id="块作用域"><a href="#块作用域" class="header-anchor">#</a> 块作用域</h4> <blockquote><p>​	我们都知道 <code>ES6</code> 引入了新的关键字 <code>let</code>， 是一种新的变量声明方式。</p></blockquote> <p><strong><code>let</code> 可以将变量绑定到所在的任意作用域中，通常是 { } 内部， 也就是 <code>let</code> 为其声明的变量隐式的劫持了所在的块作用域。</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> bar <span class="token operator">=</span> foo <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//ReferenceError</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>上面说的 <code>let</code> 的行为是隐式的，可能后续代码的维护中会将 <code>let</code> 声明移动位置造成错误，为此我们可以显示的创建一个块，将 <code>let</code>放在内部。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">let</span> bar <span class="token operator">=</span> foo <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//ReferenceError</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>使用 <code>let</code> 进行的声明不会在块作用域中提升，声明的代码被运行之前，声明并不“存在”。</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//ReferenceError</span>
        <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>let</code> 和 <code>var</code> 声明的 <code>for</code>循环区别</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//11</span>

<span class="token comment">//上述代码实际上可以看作</span>
	<span class="token keyword">var</span> i<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//相当于污染了上层作用域</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>当用 <code>let</code> 进行声明时；</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//ReferenceError</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>let</code> 不仅将 <code>i</code> 绑定在了  <code>for</code> 循环的块中，实际还将其重新绑定到了循环的每一个迭代中，确保使用上一个循环第二代结束时的值进行重新赋值。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token punctuation">{</span>
        <span class="token keyword">let</span> j<span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">let</span> i <span class="token operator">=</span> j<span class="token punctuation">;</span>		<span class="token comment">//没个i都会进行重新的绑定，</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>l
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="const"><a href="#const" class="header-anchor">#</a> const</h4> <blockquote><p>​	<code>const</code> 是 <code>ES6</code> 引入另一种声明方式，他也同样可以用来创建块级作用域，但是和 <code>let</code> 不同，使用 <code>const</code> 声明变量之后，值是固定的(当为常量的时候)，之后对常量的修改会引起错误。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>			<span class="token comment">//ReferenceError;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>其实可以看成 变量的引用地址不可改变， 当用 <code>const</code> 声明对象的时候。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;张三&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	a<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;李四&quot;</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//李四。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></blockquote> <h3 id="四、变量提升"><a href="#四、变量提升" class="header-anchor">#</a> 四、变量提升</h3> <p>JavaScript的运行顺序并不是从下到下依次运行的。</p> <p>引擎会在解释JavaScript代码之前对其进行编译， 变量和包括函数在内的 声明都会在任何代码被执行之前首先处理。</p> <p>当JavaScript 看到 <code>var a = 2;</code>	时，会把他看成两个声明， 第一部分时 <code>var a = 2</code> 是在编译阶段进行的。</p> <p>第二部分 <code>a = 2</code> 会留在原地 等待执行阶段。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token comment">//上面的代码会进行如下形式的处理。</span>
	<span class="token keyword">var</span> a<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>函数也会进行提升</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>但是函数表达式无法进行提升</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//TypeError;</span>
	<span class="token keyword">var</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token comment">//...</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//上面代码进行提升后会变成下面的样子</span>
    
    <span class="token keyword">var</span> foo<span class="token punctuation">;</span>
	<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>上面说了，声明阶段会提升，而赋值的时候，变量会停在原地，等轮到他执行的时候。</strong></p> <p><strong>函数声明和变量声明都会进行提升，但同时出现时，函数声明优先于变量声明。</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//1;</span>
	<span class="token keyword">var</span> foo<span class="token punctuation">;</span>
	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">// 	上述代码可以理解为下面的形式</span>
	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><blockquote><p>​	尽管 <code>var foo</code> 声明在 <code>function foo(){...}</code> 之前， 但是由于函数优先， 到 <code>var foo</code> 时， 发现他是重复的声明，所以自动将其忽略。</p></blockquote> <p><strong>尽管重复的声明会被忽略，但是后面的同名函数还是会覆盖前面的函数的</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//3</span>
	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="五、作用域和闭包"><a href="#五、作用域和闭包" class="header-anchor">#</a> 五、作用域和闭包</h3> <p>首先我们先来看下面的代码</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> bar<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> baz <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//2   这就是闭包</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p>​		函数 <code>bar</code> 能够通过词法作用域来访问 <code>foo()</code> 的内部作用域，我们将 <code>bar</code> 当作值类型进行传递，我们把 <code>bar</code> 所引用的函数对象当作返回值。</p> <p>foo() 执行后 其返回值也就是 <code>bar</code> 函数，赋值给变量 <code>baz</code> 并调用 <code>baz()</code> ， <strong>其实是通过不同的标识符引用调用函数 bar。</strong></p> <p>bar 可以正确的运行，但是在 自己定义的词法作用域之外的地方执行。</p> <p>​		在 <code>foo</code> 执行后，通常会期待 <code>foo()</code>整个内部作用域都会被销毁，我们的引擎有垃圾回收器来释放不在使用的内存空间，看起来 <code>foo()</code> 的内容不会被使用，所以很自然的想要对其进行回收。</p> <p>​		但是闭包的 神奇之处在于可以组织这样的事情发生，实际上内部作用域仍然存在，导致他没有被回收，谁在使用这个内部作用域呢，是 <code>bar()</code> 本身在使用。因为<code>bar</code>  声明在了函数 <code>foo</code> 的内部，它拥有了函数 <code>foo</code> 内部作用域的闭包，使得该作用域一直存在，让 <code>bar</code> 在之后任何时间都可以引用。</p> <p>​		<strong><code>bar</code> 保持着对该作用域的引用，这个引用就叫做闭包。</strong></p> <p>​		<code>bar</code> 函数在定义时的词法作用域以外被调用， 闭包使函数在别处调用时可以继续访问定义时的词法作用域。</p></blockquote> <p>无论用何种方式对函数类型的值进行传递，当函数在别处调用时都可以观察到闭包。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">baz</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//这就是闭包</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>​	 我们把内部函数 <code>bar</code> 传递给 <code>baz</code> , 当我们在<code>baz</code> 内部调用 <code>bar</code> 时（也就是<code>baz</code> 内的 <code>fn</code> 函数）， 因为闭包的缘故，他仍然可以访问 <code>foo</code>的内部变量 <code>a</code>.</p></blockquote> <p>也可以用间接的方式传递函数。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> fn<span class="token punctuation">;</span>
	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        fn <span class="token operator">=</span> baz<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//闭包；</span>
    <span class="token punctuation">}</span>
	<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>无论用何种方式将内部函数传递到词法作用域以外的地方，他都会保持对原来定义的作用域的引用，无论在何处执行这个函数都会使用闭包。</strong></p> <p>看下面一个例子</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
	<span class="token function">wait</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>我们讲一个内部函数  <code>timer</code>  传递给了 <code>setTimeout()</code> <code>timer</code>  具有涵盖 <code>wait()</code>  作用域的闭包， 因此保留了对 <code>message</code> 的引用。</p> <p>wait 执行 1000 毫秒之后，他的内部作用域仍然不会消失， <code>timer</code> 函数仍然保有 wait(...) 作用域的闭包。</p> <p>​		在引擎的内部，内置工具函数 <code>setTimeout</code> 保持着对一个参数的引用， 可能是匿名函数  在上面的代码中就是 <code>timer</code> 函数，引擎会调用这个函数，词法作用域在这个过程中保持完整。</p> <p>**本质上无论何时何地，如果将（访问他们各自词法作用域）的函数当作第一级的值类型并到处传递，你就会看到闭包的应用。 在定时器、事件监听器、AJAX请求或者任何其他的异步请求和同步请求任务中，只要使用了回调函数，其实都在使用闭包。</p> <h4 id="循环和闭包"><a href="#循环和闭包" class="header-anchor">#</a> 循环和闭包</h4> <p>​		for 循环是很常见的闭包</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>i <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>我们预期上述代码会依次输出 1 - 5 ，每秒一次， 每次一个</p> <p>实际上，他会输出 5 个 6， 每秒一次。</p> <blockquote><p>​	循环的终止条件是 <code>i &gt; 5</code> ， 首次成立的条件是 <code>i = 6</code>。 因此输出的值是循环的最终值 也就是 <code>6</code>。</p> <p>​	其实，就算是<code>setTimeout</code> 的延迟是 0 ， 输出的结果也不会变， 因为回调函数的执行是在循环结束时才执行，尽管他们在每次的时候都获取了一个 <code>i</code> 的副本，但是他们获取到的是一个在全局作用域下的  <code>i</code>  实际上是同一个 <code>i</code> 。</p></blockquote> <p>​		我们尝试用立即执行函数来改写一下这个函数。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">var</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> i <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token comment">//	下面可以对其进行一些改进</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">j</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> j <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token comment">//  使用块级作用域</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;=</span><span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> i <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token comment">// 最终方案</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">.</span> i <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token comment">//这样变量不止被声明一次，每次迭代都会进行新的声明，然后用上一次迭代的结束值来初始化该变量。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="模块"><a href="#模块" class="header-anchor">#</a> 模块</h3> <p>我们看如下代码</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">coolModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> something <span class="token operator">=</span> <span class="token string">&quot;something&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">function</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>something<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">function</span> <span class="token function">joinList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span><span class="token punctuation">{</span>
            doSomething<span class="token operator">:</span> dosomething<span class="token punctuation">,</span>
            joinList<span class="token operator">:</span> joinList
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token function">coolModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	foo<span class="token punctuation">.</span><span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//something;</span>
	foo<span class="token punctuation">.</span><span class="token function">joinList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// 1*2*3;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><blockquote><p>​	coolModule 是一个函数，必须要通过调用他来创建模块实例，如果外部没有调用该函数，则内部作用域和闭包都无法被创建。</p> <p>​	并且 <code>coolModule</code> 返回的是一个对象字面量语法 <code>{key: value}</code> 来表示的对象，这个返回对象含有对内部函数而不是对内部数据变量的引用。我们保持内部变量是隐藏并且私有的状态，可以将这个对象类型的返回值当作是模块的公共API。</p> <p>​	doSomething() 与  joinList() 函数具有涵盖模块内部作用域的闭包 (通过实例化 coolModule 来实现)。</p> <p><strong>模块模式具备两个必要的条件:</strong></p> <ul><li><strong>必须有外部的封闭函数，该函数至少要被调用一次。  （每次调用都会生成新的模块实例）</strong></li> <li><strong>封闭函数内必须返回至少一个内部函数，这样内部函数在私有作用域中能够形成闭包，并且可以修改或者访问私有的状态。</strong></li></ul></blockquote> <p>当我们只需要一个实例时，可以用立即执行函数直接生成。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">coolModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> something <span class="token operator">=</span> <span class="token string">&quot;something&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">function</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>something<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">function</span> <span class="token function">joinList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span><span class="token punctuation">{</span>
            doSomething<span class="token operator">:</span> dosomething<span class="token punctuation">,</span>
            joinList<span class="token operator">:</span> joinList
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	foo<span class="token punctuation">.</span><span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// something;</span>
	foo<span class="token punctuation">.</span><span class="token function">joinList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 1*2*3;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>模块也是普通的函数，当我们需要传入参数时，可以直接传入参数。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">coolModule</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">function</span> <span class="token function">identify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            identify<span class="token operator">:</span> identify<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> foo1 <span class="token operator">=</span> <span class="token function">coolModule</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> foo2 <span class="token operator">=</span> <span class="token function">coolModule</span><span class="token punctuation">(</span><span class="token string">&quot;456&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	foo1<span class="token punctuation">.</span><span class="token function">identify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//123</span>
	foo2<span class="token punctuation">.</span><span class="token function">identify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//456</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>我们也可以通过模块实例对内部保留对公共API的引用，对模块实例进行修改，添加或删除他们的属性。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">indentify</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">function</span> <span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            publicApi<span class="token punctuation">.</span>identify <span class="token operator">=</span> identify2<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">function</span> <span class="token function">identify1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">function</span> <span class="token function">identify2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>id<span class="token punctuation">.</span>toUpperCase<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">var</span> publicApi <span class="token operator">=</span> <span class="token punctuation">{</span>
            identify<span class="token operator">:</span> identify1<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> publicApi<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&quot;cool Module&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	foo<span class="token punctuation">.</span><span class="token function">identify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// cool Module</span>
	foo<span class="token punctuation">.</span><span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	foo<span class="token punctuation">.</span><span class="token function">identify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// COOL MODULE</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="第二部分-this-和-对象原型"><a href="#第二部分-this-和-对象原型" class="header-anchor">#</a> 第二部分 this 和 对象原型</h3> <h4 id="第一章-关于this"><a href="#第一章-关于this" class="header-anchor">#</a> 第一章 关于this</h4> <h4 id="_1-1-为什么要使用this"><a href="#_1-1-为什么要使用this" class="header-anchor">#</a> 1.1 为什么要使用this</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">identify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">function</span> <span class="token function">speak</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> greet <span class="token operator">=</span> <span class="token string">&quot;hello, i am &quot;</span> <span class="token operator">+</span> <span class="token function">identify</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>greet<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> me <span class="token operator">=</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">&quot;jake&quot;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> you <span class="token operator">=</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">&quot;mike&quot;</span>
    <span class="token punctuation">}</span>
    <span class="token function">identify</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>me<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// JAKE;</span>
	<span class="token function">identify</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>you<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// MIKE;</span>
	<span class="token function">speak</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>me<span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// hello, i am JAKE;</span>
	<span class="token function">speak</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>you<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// hello, i am MIKE;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>如果不想使用<code>this</code> 就要给 函数 <code>identify()</code>  和  <code>speak()</code>  显示的传入一个上下文对象；</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">identify</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> context<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">function</span> <span class="token function">speak</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> greet <span class="token operator">=</span> <span class="token string">&quot;hello, i am &quot;</span> <span class="token operator">+</span> <span class="token function">identify</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>greet<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> me <span class="token operator">=</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">&quot;jake&quot;</span>
    <span class="token punctuation">}</span>
	<span class="token function">identify</span><span class="token punctuation">(</span>me<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// JAKE</span>
	<span class="token function">speak</span><span class="token punctuation">(</span>me<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// hello, i am JAKE</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>可以看到， <code>this</code> 使用了一种更优雅的方式来隐式的“传递” 一个对象引用，使得API设计的更加简洁和容易复用。</p> <h4 id="_1-2-this"><a href="#_1-2-this" class="header-anchor">#</a> 1.2 this</h4> <p>看下面的代码</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span> <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	foo<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> i<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">foo</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
	<span class="token comment">//我们想通过 foo.count 计数 来打印出foo调用的次数</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//  0;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><blockquote><p>​		当我们执行到 foo.count = 0 时，的确向函数对象<code>foo</code> 增加了一个属性 <code>count</code> ， 但函数内部代码的 <code>this</code> 指向并不相同。</p></blockquote> <p><strong><code>this</code> 在任何情况下，都不指向函数的词法作用域</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// ReferenceError: a is not defined;</span>
<span class="token comment">//		实际上this.bar() 正常是调用不成功的 </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="this-到底是什么"><a href="#this-到底是什么" class="header-anchor">#</a> this 到底是什么</h4> <ul><li>this 是运行时绑定的，并不是在编写时绑定的，他的上下文取决于函数调用时的各种条件。this的绑定和函数声明的位置没有任何关系，只取决于函数的调用方式。</li> <li>当函数被调用时，会创建一个活动记录（简称： 上下文），这个记录会包含函数在哪里调用，调用的方式，函数的参数等等，this 就是这个记录的属性，在函数执行的时候会被用到。</li> <li>可以理解为，this 的指向完全取决于函数在哪里调用。</li></ul> <h3 id="第二章-this-全面解析"><a href="#第二章-this-全面解析" class="header-anchor">#</a> 第二章   this 全面解析</h3> <p>在理解this 之前，首先要理解</p> <ul><li>调用位置： 调用位置就是函数在代码中被调用的位置（而不是声明的位置）。</li> <li>调用栈：为了达到当前调用位置所调用的所有函数。</li></ul> <p>调用位置其实就是当前执行的函数前一个调用。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//调用栈是   baz   </span>
        <span class="token comment">//当前调用位置是全局作用域</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;baz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//bar 调用位置</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 调用栈 baz =&gt; bar</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//  当前调用位置在 baz 中</span>
        <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// foo 调用位置</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 调用栈  baz =&gt; bar =&gt; foo</span>
        <span class="token comment">// 当前调用位置在 bar 中；</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// baz的调用位置</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="绑定规则"><a href="#绑定规则" class="header-anchor">#</a> 绑定规则</h4> <h5 id="_2-1-默认绑定"><a href="#_2-1-默认绑定" class="header-anchor">#</a> 2.1 默认绑定</h5> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>​	上面代码 <code>var a = 2</code> 是全局变量，在调用函数 foo ()  时，应用了<code>this</code>  的默认绑定，因此 <code>this</code> 指向全局对象。</p></blockquote> <h5 id="_2-2-隐式绑定"><a href="#_2-2-隐式绑定" class="header-anchor">#</a> 2.2 隐式绑定</h5> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
        a<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        foo<span class="token operator">:</span> foo<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    obj<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//	2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>​	首先要注意foo 的声明方式，以及后续被当作引用属性添加到 <code>obj</code> 当中，这个函数严格来说并不属于 <code>obj</code> 这个对象。</p> <p>​	调用位置会根据上下文来引用函数，也可以说函数被调用时， obj 对象 拥有或者包含他。</p> <p>​	当函数被调用时，前面确实加上了对obj 的引用，当函数引用有上下文对象时，隐式绑定规则会把 <code>this</code> 绑定到这个上下文对象，因此调用 <code>foo()</code> 时，<code>this</code> 被绑定到 <code>obj</code>， 因此， <code>this.a</code>  与 <code>obj.a</code> 是一样的。</p></blockquote> <p><em>对象属性引用链只有上一层或者最后一层在调用的位置中起作用。</em></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span>
        a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
        foo<span class="token operator">:</span> foo<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
        a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
        obj2<span class="token operator">:</span> obj2<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
	<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>隐式丢失</strong></p> <p>一个常见的this 绑定问题就是被隐式绑定的函数会丢失绑定对象，也就是会应用默认绑定，把this 绑定在 全局  或者 &quot;undefined&quot;上。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
        a<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        foo<span class="token operator">:</span> foo
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> bar <span class="token operator">=</span> obj<span class="token punctuation">.</span>foo<span class="token punctuation">;</span>
	<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">&quot;global a&quot;</span><span class="token punctuation">;</span>
	<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// &quot;global a&quot;;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>​	虽然 bar 是对 obj.foo 的一个引用，实际上引用的是 foo 函数本身，此时  bar() 是一个不带任何修饰符的函数调用，因此应用了默认绑定。</p></blockquote> <p>另一个更常见的出现在传入回调的时候</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">function</span> <span class="token function">doFoo</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
        a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        foo<span class="token operator">:</span> foo
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">&quot;global a&quot;</span><span class="token punctuation">;</span>
	<span class="token function">doFoo</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//&quot;global a&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><blockquote><p>​	参数传递其实就是隐性赋值，我们传入函数时也会被隐性赋值。</p></blockquote> <h5 id="_2-3-显示绑定"><a href="#_2-3-显示绑定" class="header-anchor">#</a> 2.3 显示绑定</h5> <p>我们可以通过 <code>call()</code> 和 <code>apply()</code>  来进行显示绑定</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
        a<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>​		通过foo.call(obj)  可以在调用foo 时 把他的 <code>this</code> 强制绑定在 <code>obj</code> 上。</p> <p>​		如果你传入的是一个原始值（字符串类型、布尔类型 、数字类型）当作 <code>this</code> 的绑定对象，这个原始值会被转换成他的对象形式 ( 也就是 new String(...), new Boolean(...), new Number(...)) 这也叫做装箱。</p> <p><strong>1 硬绑定</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
        a<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> <span class="token function-variable function">bar</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//2</span>
	<span class="token function">setTimeout</span><span class="token punctuation">(</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//2</span>
	<span class="token function">bar</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//2		硬绑定之后无法在修改他的this</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><blockquote><p>​	在上面的代码里，我们创建了bar 函数, 并在他的内部手动调用了 foo.call(obj) ， 因此强制的把 foo 的 this 绑定到了 obj。 无论之后如何调用函数 bar, 他总会手动在obj 上调用 foo ， 这种绑定是一种显示的绑定，我们也叫他硬绑定。</p></blockquote></blockquote> <p>硬绑定的典型应用场景就是创建一个包裹函数，负责接受参数并返回值。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">something</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">,</span> something<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">+</span> something<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
        a<span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> <span class="token function-variable function">bar</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 2  3</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>  	<span class="token comment">// 5</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>另一个使用方法是创建可重复使用的辅助函数</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">something</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">,</span> something<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">+</span> something<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
        a<span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token function">bind</span><span class="token punctuation">(</span>foo<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//2 3</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//5</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>由于硬绑定是一种常用的模式， 所以 ES5 提供了一种内置方法  <code>Function.prototype.bind</code> 。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">something</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">,</span> something<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">+</span> something<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
        a<span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 2 3</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 5</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>bind()	会返回一个硬编码的新函数，它会把你指定的参数设置为 <code>this</code> 的上下文并调用原始参数。</p> <h5 id="_2-4-new-绑定"><a href="#_2-4-new-绑定" class="header-anchor">#</a> 2.4 new 绑定</h5> <p>使用new 来调用函数，会自动执行下面的操作</p> <ul><li>创建一个全新的对象。</li> <li>这个新对象会执行[[prototype]] 的连接。</li> <li>这个新对象会绑定到函数调用的 this。</li> <li>如果函数没有返回对象，那么 new 表达式中的函数调用会自动返回这个新对象。</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> a<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bar<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> 	<span class="token comment">//2	</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>使用new 来调用 foo(...) 时，我们会构造一个新的对象，并把它绑定在 foo (...) 调用中的 this 上。</p> <h4 id="绑定优先级"><a href="#绑定优先级" class="header-anchor">#</a> 绑定优先级</h4> <p>默认绑定优先级最低</p> <ul><li><p>隐式绑定和显示绑定：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
        a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        foo<span class="token operator">:</span> foo
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span>
        a<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        foo<span class="token operator">:</span> foo
    <span class="token punctuation">}</span>
    obj1<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//	1</span>
	obj2<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//  2</span>
	obj1<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//2</span>
	obj2<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>所以显示绑定优先级比隐式绑定更高</p> <blockquote><p>现在优先级关系    显示绑定 &gt; 隐式绑定 &gt; 默认绑定-+</p></blockquote></li> <li><p>下面看new 和 隐式绑定的优先级关系</p></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">something</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> something<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
        foo<span class="token operator">:</span> foo
    <span class="token punctuation">}</span>
    
    <span class="token keyword">var</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    obj1<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//2</span>

	obj1<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj2<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//3</span>

	<span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">obj1<span class="token punctuation">.</span>foo</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//2</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bar<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//4</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>可以看出 new 绑定比隐式绑定优先级高。</p> <p>我们可以根据优先级来判断函数在某个调用位置应用的哪条规则。</p> <ul><li><p>函数是否在 new 中调用，如果是的话 this 绑定的是新调用的对象。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>函数是否通过 call 、 apply (显示绑定) 或者 硬绑定调用，如果是的话， this 绑定的是指定的对象</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>		
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>函数是否在某个上下文环境中调用（隐式绑定），如果是的话， this 绑定的就是那个上下文对象。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> bar <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>如果都不是的话，就是默认绑定，在严格模式下，就绑定到undefined，否则是全局对象。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <h5 id="_2-5-this-词法"><a href="#_2-5-this-词法" class="header-anchor">#</a> 2.5 this 词法</h5> <p>箭头函数不是通过function 关键字进行定义的，是使用 <code>=&gt;</code> 定义的，箭头函数不使用上述4条规则，而是根据外层的作用域来决定 <code>this</code> 。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
        a<span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span>
        a<span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">bar</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>foo 内部创建的箭头函数会捕获调用时 foo() 的 this， 由于 foo 的 this  绑定到了 obj1,  bar(引用箭头函数）的this 也会绑定的 obj1，箭头函数的绑定无法修改。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
        a<span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
    <span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p>​	箭头函数可以像 this 一样确保函数的 <code>this</code> 被绑定到指定的对象</p></blockquote> <p>在 ES6 之前还可以用另一种方式取代箭头函数</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
        a<span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
    <span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>只用词法作用域，并且抛弃错误 this 风格的代码</li> <li>完全采用 this 的风格， 必要时使用 bind() ， 尽量避免使用 that = this 以及箭头函数。</li></ul> <h3 id="第三章、-对象"><a href="#第三章、-对象" class="header-anchor">#</a> 第三章、 对象</h3> <h4 id="_3-1-语法"><a href="#_3-1-语法" class="header-anchor">#</a> 3.1 语法</h4> <p>​		对象可以通过两种形式来定义： 声明（文字）形式和构造形式。</p> <p>​		对象的文字语法：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> myObj <span class="token operator">=</span> <span class="token punctuation">{</span>
        key<span class="token operator">:</span> value
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>​		构造形式：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> myObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	myObj<span class="token punctuation">.</span>key <span class="token operator">=</span> value<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>​	上面两种方式声明的对象是一样的，只不过通过文字形式可以直接声明多个键值对，而构造形式需要逐个添加属性。</p></blockquote> <h4 id="_3-2-类型"><a href="#_3-2-类型" class="header-anchor">#</a> 3.2 类型</h4> <p>JavaScript中一共有6中主要类型</p> <ul><li>string</li> <li>number</li> <li>boolean</li> <li>null</li> <li>undefined</li> <li>object</li></ul> <p>简单基本类型 string 、 number 、 boolean 、 null 、 undefined  本身并不是对象，（typeof null 时会返回 object 时 BUG），null也是基本类型。</p> <p>JavaScript 内置了一些对象子类型，也成为内置对象</p> <ul><li>String</li> <li>Number</li> <li>Boolean</li> <li>Object</li> <li>Function</li> <li>Array</li> <li>Date</li> <li>RegExp</li> <li>Error</li></ul> <p>这些内置函数可以当作构造函数使用，来构造对应的子对象类型的新对象。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">&quot;i am a string&quot;</span><span class="token punctuation">;</span>
	<span class="token keyword">typeof</span> str<span class="token punctuation">;</span>		<span class="token comment">// string;</span>
	str <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">;</span>	<span class="token comment">//	false</span>

	<span class="token keyword">var</span> strObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;i am a string&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">typeof</span> strObj<span class="token punctuation">;</span> 	<span class="token comment">//object;</span>
	strObj <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">;</span>	<span class="token comment">//true;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>引擎会自动的把字面量转换成 String ， 我们可以访问上面的一些方法；</p> <h4 id="_3-3内容"><a href="#_3-3内容" class="header-anchor">#</a> 3.3内容</h4> <p>​		对象的内容是有一些存储在特定位置的值组成的，我们称之为属性， 这些值不会存储在对象容器的内部，存储在对象容器内部的是这些值的名称，他们就像指针一样，指向这些值真正的存储位置。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">&quot;jack&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    obj<span class="token punctuation">.</span>name    <span class="token comment">//jack</span>
	obj<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span>	<span class="token comment">//jack</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>​	当我们想要访问 <code>obj</code> 中 <code>name</code> 的值，我们可以通过 <code>.</code> 操作符 或者 <code>[&quot;&quot;]</code> 操作符，<code>.</code> 语法通常被称为属性访问， <code>[&quot;&quot;]</code> 语法通常被成为键值对访问，这两种方式访问的是同一个地址， 都会返回 <code>name</code> 的值为 <code>jack</code>。</p></blockquote> <p>​		在对象中，属性名永远是字符串，如果你使用字符串以外的类型来作为对象名，他会首先被转换成字符串。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	obj<span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>
	obj<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">;</span>
	obj<span class="token punctuation">[</span>obj<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;baz&quot;</span><span class="token punctuation">;</span>

	obj<span class="token punctuation">[</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>	<span class="token comment">//foo</span>
	obj<span class="token punctuation">[</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>		<span class="token comment">//bar</span>
	obj<span class="token punctuation">[</span><span class="token string">&quot;obj&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>		<span class="token comment">//baz</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>​		如果我们需要可计算属性名，我们可以用 <code>[]</code>这种方式。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> pre <span class="token operator">=</span> <span class="token string">&quot;pre&quot;</span>	
	<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> 
    	<span class="token punctuation">[</span>pre <span class="token operator">+</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>pre <span class="token operator">+</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
	obj<span class="token punctuation">[</span><span class="token string">&quot;prebar&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>	<span class="token comment">//bar;</span>
	obj<span class="token punctuation">[</span><span class="token string">&quot;prefoo&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>	<span class="token comment">//foo;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="属性描述符"><a href="#属性描述符" class="header-anchor">#</a> 属性描述符</h5> <p>​		在ES5之前，JavaScript 语言本身没有提供可以直接监测属性特性的方法，比如判断是否可读，在ES5开始，所有的属性都具备的属性描述符。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">&quot;jack&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//{</span>
    <span class="token comment">//	writable: true,				可写</span>
    <span class="token comment">//  enumerable: true,			可枚举</span>
    <span class="token comment">//  configurable: true,			可配置</span>
    <span class="token comment">//}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h5 id="get"><a href="#get" class="header-anchor">#</a> [[GET]]</h5> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">&quot;jack&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    obj<span class="token punctuation">.</span>name<span class="token punctuation">;</span>	<span class="token comment">//jack;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>​		上面看起来是一次属性访问，但这条语句并不仅仅是在 obj 内部查找 <code>a</code>的属性，对象内置的 [[GET]] 操作首先在 <code>obj</code> 内部查找是否具有相同的属性，如果找到则返回这个属性的值， 如果找不到，会按照一条链继续寻找，也就是原型链， 如果无论如何都找不到该属性，则返回 <code>undefined</code>。</p> <h4 id="_3-4遍历"><a href="#_3-4遍历" class="header-anchor">#</a> 3.4遍历</h4> <p>对于数值类型的数组来说，可以使用标准的 for 循环进行遍历</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>		<span class="token comment">//这种其实不是遍历值，是在遍历数组的下标，对其进行取值。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ES 6 增加了一种遍历数组的方法 for... of</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> v <span class="token keyword">of</span> arr<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>for ... of 循环会首先向被访问对象请求一个迭代器对象， 然后通过迭代器对象的<code>next()</code> 方法来遍历所有的返回值。</p> <p>数组内部含有内置的 <code>@@iterator</code> ， 因此for ... of 可以直接应用到数组上。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> item <span class="token operator">=</span> arr<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	item<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//{value: 1, done: false};</span>
	item<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//{value: 2, done: false};</span>
	item<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//{value: 3, done: false};</span>
	item<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//{done: true};</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="第四章、混合对象-类"><a href="#第四章、混合对象-类" class="header-anchor">#</a> 第四章、混合对象“类”</h3> <p>​		上一章介绍了对象，这章介绍类相关的面向对象的编程。在研究类的具体机制之前，先说说面向类的设计模式： 实例化、继承、多态。</p> <h4 id="类"><a href="#类" class="header-anchor">#</a> 类</h4> <p>类、继承描述了一种代码的组织结构形式—— 一种在软件中对真实世界领域中的建模方法。</p> <p>面向对象的编程强调的是数据和操作数据的行为本质上是相互关联的， 好的设计就是把数据以及他的相关行为打包起来。这样也称为数据结构。</p> <p>​		在 <code>ES6</code> 之前，JavaScript 中只有近似类的语法结构如： <code>new</code> 和 <code>instanceof</code>  在 <code>ES6</code> 中，增加了 <code>class</code> 关键字。</p> <h3 id="第五章、-prototype"><a href="#第五章、-prototype" class="header-anchor">#</a> 第五章、[[Prototype]]</h3> <p>​		JavaScript 中有一个特殊的内置属性 <code>[[Prototype]]</code>， 其实就是对其他对象的引用，几乎所有的对象在创建时，<code>[[prototype]]</code>属性都会被赋予一个非空的值。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>	<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">&quot;jack&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.84afcb5e.js" defer></script><script src="/assets/js/2.5a4a2598.js" defer></script><script src="/assets/js/5.4013f8dd.js" defer></script>
  </body>
</html>
